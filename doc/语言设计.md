# 歧语言的源代码语法主要设计


## Unicode 字符集划分

+ 属于歧语言编译器的源代码预处理过程.

歧语言的源代码文件全部以 `utf-8` 编码方式存储,
使用编码规范: 最新版 Unicode 规范.

建议使用文件后缀 `.歧`

Unicode 有许多优点, 然而同时 Unicode 是个大坑,
具有很大的复杂性, 处理时必须小心谨慎, 避免翻车.

歧语言将所有 Unicode 字符分为以下 3 类:

1. **禁止使用**

   禁止在源代码中使用和源代码文件中出现的字符.
   此类字符会被歧语言相关工具 (歧编, 歧格 等) 直接过滤掉 (忽略).
   同时歧语言相关工具会对 Unicode 文本进行标准化 (具体 TODO).

   比如 Unicode 未定义的字符, 大部分控制字符, 零宽度空格 等.

   这些字符不适合直接出现在源代码中 (如果必需请使用转义序列形式),
   会对源代码的编辑/阅读等造成障碍或不必要的麻烦.

   具体包括: TODO

2. **语法字符**

   此类字符具有特殊的语法意义, 会被编译器识别并单独处理.

   比如 换行, 空格, 大部分 ASCII 符号, 部分中文标点符号 等.

   具体包括: TODO

3. **普通字符**

   此类字符可用来组成标识符,
   会被编译器作为普通短语进行切分等处理.

   不属于上面两类的 Unicode 字符全部属于此类.

   下列字符保证会作为普通字符, 不会被分为上面两类:

   + ASCII:

     - `0-9` 数字

     - `A-Za-z` 字母

     - `_` 下划线

     - `.` 小数点

   + 所有中文汉字

上述字符分类可能随时调整, 因而可能会打破源代码的兼容性.
所以尽量不要使用太奇怪的字符.


## 词法分析

在源代码预处理之后, 歧语言编译器首先将源代码字符串,
切分成若干 "词" (token).

每个源代码中的字符, 属于且仅属于一个 "词".

歧语言的源代码词分为以下类型: (8)

+ `换行`

+ `注释`

+ `空白`

+ `缩进`

+ `字符串`

+ `数字`

+ `语法字符`

+ `初级短语`

### 注释和空行

歧语言的注释字符是 `#` (类似 Python).
一行从 `#` 开始直到行尾是注释.

在字符串环境中的 `#` 字符不被认为是注释的开始.

空行会被直接忽略.

### 缩进

行首的每 2 个空格表示一级缩进.

### 字符串与引号转义规则

这一部分可能是词法分析中最复杂的部分.

TODO

### 数字

也叫数字字面量, 比如 `666`.

TODO

### 语法字符

具有特殊语法意义的字符, 比如 逗号, 顿号, 句号, 冒号 等.

TODO

### 初级短语

不属于上述分类的, 源代码剩下的部分.


## 语法分析

语法分析分为初步分析和再次分析.

初步分析处理固定语法结构.
再次分析在初步分析的基础上, 对剩余的一般短语进行切分.

语法树节点具有以下类型:

+ `包`

  一次编译的任务单元, 包之间可以有相互依赖.
  (类似 rust 的 crate)

+ `模块`

  一个模块是一个 `.歧` 源代码文件.

  模块之间可以相互依赖 (导入/导出).

+ `代码块`

  对一级缩进的抽象.

+ `定义`

  定义函数, 变量, 类型.

+ `标记`

  定义 标记.

+ `分支`

+ `循环`

+ `函数调用`

+ `赋值`

+ `括号` (求值, 优先级)

+ `层次访问` (的)

+ `返回`

+ `导入`

+ `导出`

+ `一般短语` (临时)

TODO

### 初步分析

+ **行首关键词**

  只有在行首 (或者缩进后行首) 才有效的关键词.

  - `定义`

  - `若`

  - `另`

  - `匹配`

  - `循环`

  - `返回`

  - `导入`

  - `导出`

+ **一般关键词**

  在一般短语中具有特殊语法意义的关键词.

  - `的`

  - `是`

  - `不是`

  - `了` (保留)

  - `调用` (保留)

+ 局域关键词: 在相应的 行首关键词 环境下才有意义的关键词.

  - `定义`: `类型`, `变量`, `标记`, `参数`, `枚举`

  - `循环`: `次`, `步长`, `至`, `到`, `变量`, `若`, `直到`

  - `另`: `若` (`另若`)

TODO

### 再次分析

TODO
