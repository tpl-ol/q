# 歧语言主要语法设计 (草稿)

## 基本规则

+ 支持常见的中文标点, 半角/全角标点。

+ 使用缩进区分代码块 (类似 Python)。

+ 主要语法风格为: **主-谓** (谁做什么) 或 **动-宾** (操作什么)。

+ 当有歧义时, 编译错误。

## 具体设计及栗子

### 1 文件编码

源文件统一使用 `utf-8` 编码。

建议文件名后缀为 `.歧` 比如: `测试.歧`

### 2 注释

以 `#` 开始直到行尾是注释, 注释会被编译器直接忽略。

```sh 歧
# 这是注释
```

### 3 缩进与空格

除了行首的空格, 都会被编译器直接忽略。
也就是说, 基本可以在源代码任意添加空格。

特殊情况: 数字 (比如 `123`) 前面必须是一个标点或空格,
否则会被解释成标识符, 而不是数字。

比如:

```sh 歧
定义加1, 参数值:
  值 + 1

加1 1。  # 加1(1)

定义移动, 参数水平、垂直:
  过。

移动 200、50。  # 移动(200, 50)
```

行首的空格用于决定缩进, 注意此处只有 ASCII 的空格字符 (` `) 有效,
别的空白字符 (比如制表符) 全部无效。

根据缩进界定代码块 (类似 Python 的语法)。

建议每一级缩进使用 2 个空格。

### 4 字符串与引号规则

字符串使用引号表示边界, 语法类似 JavaScript。

| 边界字符 | 说明 |
| :------ | :--- |
| `"` `'` | 普通字符串 |
| ` | 模板字符串 |
| `“` `”` | 中文引号 (支持全角/半角) |

+ 具有极性的引号 (比如中文引号), 处理方式类似括号匹配。

+ 多个引号字符重复 (比如 `"""`), 则要求与其对应的结束标记。

模板字符串语法: 使用 `{{` `}}` 替换 (mustache). 比如:

```sh 歧
输出 `早上好, {{ 昵称 }}`。
```

转义字符表: (TODO)

| 转义序列 | 相当于 | 说明 |
| :------ | :----- | :-- |
| `\\` | `\` | 转义字符自身转义 |
| `\"` | `"` | 字符串边界字符转义 (别的引号类似) |
| `\n` | | 换行字符 |

### 5 中文标点与半角全角

支持英文标点, 中文标点, 半角标点, 全角标点。

等效标点符号会被转换后处理, 比如全角标点被转换成对应的半角标点,
中文标点被转换成对应的英文标点。

编译器首先进行等效标点转换, 然后进行语法解析。

等效标点对照表: (TODO)

| 英文标点 | 中文半角标点 | 中文全角标点 (TODO) | 说明 |
| :------ | :---------- | :---------- | :-- |
| `.` | | | 小数点, 无对应中文标点 |
| | `。` | | 句号, 无对应英文标点 |
| | `、` | | 顿号, 无对应英文标点 |
| `,` | `，` | | 逗号 |
| `:` | `：` | | 冒号 |
| `;` | `；` | | 分号 |
| `!` | `！` | | 感叹号 |
| `?` | `？` | | 问号 |
| `(` `)` | `（` `）` | | |

不在上表中的标点符号不进行处理。

### 6 关键字

无条件关键字 (7 个): 代码 (短语) 中的任何位置都作为关键字处理。

| 关键字 | 说明 |
| :---- | :--- |
| `的` | 访问对象的属性 (`.`) |
| `了` | 异步代码 (await) |
| `是` | 赋值, 条件判断 (`=`, `==`, `===`) |
| `在` | (保留) |
| `着` | (保留) |
| `把` | (保留) |
| `被` | (保留) |

句首关键字: 只在句子的开头作为关键字。

| 关键字 | 说明 |
| :---- | :--- |
| `定义` | 定义语句: 定义函数, 变量等 (def) |
| `若` | 条件语句 (if) |
| `另` | 条件语句 (else), `另若` |
| `循环` | 循环语句 (for) |
| `当` | 循环语句 (while) |
| `返回` | 函数提前返回 (return) |
| `断` | 跳出循环 (break) |
| `继续` | 终止本次循环 (continue) |
| `选择` | 多分支语句 (switch) |
| `情况` | 多分支语句 (case) |
| `过` | 空代码块 (pass), 类似 Python |
| `导入` | 模块导入 (import) |
| `导出` | 模块导出 (export) |
| `产生` | 用于生成器函数 (yield) |

定义关键字: 在 `定义` 语句中使用。

| 关键字 | 说明 |
| :---- | :--- |
| `变量` | 定义变量 (let) |
| `常量` | 定义常量 (const) |
| `异步` | 定义异步函数 (async) |
| `外部` | 定义外部函数或变量 (extern) |
| `类` | 定义类 (class) |
| `生成器` | 定义生成器函数 (generator) |

描述关键字: 在定义语句中辅助说明定义内容。

| 关键字 | 说明 |
| :---- | :--- |
| `参数` | 函数的参数 |
| `扩展` | 类的继承关系 |

条件关键字: 在条件语句的判断条件中使用。

| 关键字 | 说明 |
| :---- | :--- |
| `不` | 比如 `不是` |

循环关键字: 在 `循环` 语句中使用。

| 关键字 | 说明 |
| :---- | :--- |
| `次` | 循环次数 |
| `至` | 循环范围的起止 |
| `步长` | 循环范围的步长 |

预定义全局常量:

| 名称 | 说明 |
| :-- | :--- |
| `真` | 布尔类型 (true) |
| `假` | 布尔类型 (false) |
| `非数` | 特殊数字值 (NaN) |
| `无穷` | 特殊数字值 (Infinity) |
| `空` | 特殊值 (null) |

### 7 语句 (短语) 的分隔

大句子: 以换行、句号 (`。`)、冒号 (`:`)、感叹号 (`!`)、问号 (`?`) 等字符结束。

+ 换行: 计算表达式。

  ```sh 歧
  x = y + 2
  ```

+ 句号: 普通语句。

  ```sh 歧
  输出昵称。
  ```

+ 冒号: 缩进代码块。

  ```sh 歧
  若成绩 < 60:
    “不及格”
  ```

+ 感叹号: 抛出错误 (throw)。

  ```sh 歧
  若人数是 0:
    错误 “除数不能是 0” !
  ```

+ 问号: 捕捉错误 (try-catch)。

  ```sh 歧
  打开文件 “测试.txt” ? 错误 “打开文件失败” !
  ```

小句子: 以逗号 (`,`)、分号 (`;`) 等字符结束。

+ 逗号:

  补充说明:

  ```sh 歧
  定义计数, 参数值:
    值 + 1
  ```

  嵌套调用:

  ```sh 歧
  # 输出(格式化(优化(检查(程序))))
  检查程序, 优化, 格式化, 输出。
  ```

+ 分号: 链式调用。

  ```sh 歧
  # 数据.split().filter().map().filter().map().join();
  数据切分; 过滤; 映射; 过滤; 映射; 拼接。
  ```

顿号 (`、`): 调用函数的参数列表。

```sh 歧
比较 20、30。
```

### 8 定义语句

定义变量:

```sh 歧
# 没有初始值
定义变量昵称。

昵称是 “喵喵”。  # 赋值语句形式 1
昵称 = “喵呜”  # 赋值语句形式 2

# 带有初始值的变量
定义变量人数, 10。
```

定义函数:

```sh 歧
定义调试, 参数内容:
  输出 “调试: {{ 内容 }}”

调试 “某功能”。  # 调试: 某功能
```

### 9 函数调用

无参数:

```sh 歧
定义退出:
  过。

退出。
```

一个参数:

```sh 歧
定义输出, 参数内容:
  过。

定义变量昵称, “喵喵”。

输出昵称。  # 喵喵

输出 “你好世界”。  # 你好世界
```

多个参数:

```sh 歧
定义设置体积, 参数长、宽、高:
  过。

# 3 个参数
设置体积 100、200、50。
```

### 10 括号语法

小括号:

+ 运算优先级。

  ```sh 歧
  x = (y + 1) * z
  ```

+ 取函数自身, 而不是调用函数。

  ```sh 歧
  定义变量测试1, 退出。  # 测试1 = 退出()

  定义变量测试2, (退出)。  # 测试2 = 退出
  ```

中括号:

+ 定义数组。

  ```sh 歧
  定义变量测试, [1, 2, 3]。

  输出测试的长度。  # 3
  ```

+ 数组下标访问。

  ```sh 歧
  定义变量测试, [“喵喵”, “喵呜”]。

  输出测试[0]。  # 喵喵
  ```

大括号:

+ 定义对象。

  ```sh 歧
  定义变量测试, {
    喵喵体重: 20,
    喵呜体重: 30,
  }。

  输出测试的喵喵体重。  # 20
  ```

### 11 分支

二分支:

```sh 歧
定义结果, 参数分数:
  若分数 < 60:
    “不及格”
  另若分数 < 80:
    “良好”
  另:
    “优秀”
```

多分支:

```sh 歧
定义格式化, 参数星期:
  选择星期:
    情况 1:
      “星期一”
    情况 2:
      “星期二”
    情况:
      “默认情况”
```

### 12 循环

有限循环 (for):

```sh 歧
循环 3 次:
  输出 “重要的事情说 3 遍 !”。
# 重要的事情说 3 遍 !
# 重要的事情说 3 遍 !
# 重要的事情说 3 遍 !

循环 3 次, 变量计数:
  输出计数。
# 0
# 1
# 2

循环 3 次, 变量计数:
  输出(计数 + 1)。
# 1
# 2
# 3

循环 1 至 3, 变量计数:
  输出计数。
# 1
# 2
# 3

循环 3 至 9, 步长 3, 变量计数:
  输出计数。
# 3
# 6
# 9

定义数组测试, [1, 22, 300]。

循环测试, 变量值:
  输出值。
# 1
# 22
# 300
```

无限循环 (while):

```sh 歧
定义年份:
  过。

定义海枯石烂:
  年份 > 1_0000。

当真:
  若海枯石烂:
    断。
  输出 “程序运行中 .. .”。
```

```sh 歧
定义还有任务需要处理:
  过。

定义随机:
  过。

定义类任务:
  定义无效:
    若随机 < 0.5:
      真。
    另:
      假。

定义取一个任务:
  新的任务。

定义处理, 参数任务:
  过。

当还有任务需要处理:
  定义变量任务, 取一个任务。
  若任务无效:
    继续。
  处理任务。
```

### 13 面向对象

```sh 歧
定义类读者:
  定义变量昵称。
  定义变量年龄。

  定义欢迎, 参数自己:
    输出 “欢迎 {{ 自己的年龄 }} 岁的{{ 自己的昵称 }} !”。

定义变量测试, 新的读者。
测试的昵称是 “喵喵”。
测试的年龄是 18。

测试欢迎。  # 欢迎 18 岁的喵喵 !
```

### 14 模块

```sh 歧
定义计算, 参数值:
  值 + 1

导出计算。  # export 计算;
```

```sh 歧
导入标准库。  # import * from "标准库";

导入网络请求, axios。  # import 网络请求 from "axios";

导入标准库 (工具1, 工具2)。  # import { 工具1, 工具2 } from "标准库";
```

### 15 外部

```sh 歧
定义外部 (js) 设超时 (setTimeout), 参数回调、毫秒。
```

### 16 标准库

```sh 歧
# 栗子: js 标准库
定义类控制台类:
  定义外部写 (log), 参数内容。

定义外部 (js) 变量控制台 (console), 类控制台类。

定义输出, 参数内容:
  控制台的写内容。

导出输出。

# 测试
输出 “测试成功”。
```

### 17 异步

```sh 歧
定义设超时, 参数回调、毫秒:
  过。

# 异步
定义睡眠, 参数毫秒:
  定义回调, 参数成功、失败:
    设超时成功、毫秒。
  新的许诺回调。

定义异步测试:
  输出 “测试开始”。
  睡眠了 100。
  输出 “测试 1”。
  睡眠了 200。
  输出 “测试 2”。
```

### 18 错误处理

```sh 歧
定义人均, 参数总量、人数:
  若人数是 0:
    # 抛出错误
    错误 “人数不能是 0” !
  总量 / 人数。

人均 20、50。
```

```sh 歧
定义打开, 参数文件名:
  过。

定义测试:
  定义变量文件, “测试.txt”。
  输出 “尝试打开文件”。

  # 尝试捕捉错误并处理
  打开文件 ?:
    输出 “打开失败”。
    返回。

  输出 “打开成功”。

测试。
```

### 19 生成器与迭代器

TODO

### 20 补充栗子

TODO

(2021-10-13)
